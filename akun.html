<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Akun Saya - UNNES STUDY ZONE</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="shortcut icon" href="icon.png" type="image/x-icon">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
    
    body {
      font-family: 'Poppins', sans-serif;
      scroll-behavior: smooth;
      padding-top: var(--navbar-height, 90px); /* Adjust for fixed navbar */
    }
    nav {
        font-family: 'Inter', sans-serif;
    }
    nav#navbar {
      height: var(--navbar-height, 90px);
    }
    
    /* Modern gradient backgrounds */
    .bg-gradient-blue {
      background: linear-gradient(135deg, #4F46E5 0%, #2563EB 100%);
    }
    
    .bg-gradient-card {
      background: linear-gradient(135deg, #ffffff 0%, #f3f4f6 100%);
    }

    /* Initial gradient for the navbar from new.html */
    .bg-gradient-hero-nav {
      background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 35%, #7c3aed 100%);
    }
    
    /* Custom animations */
    @keyframes float {
      0%, 100% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
    }
    .animate-float { animation: float 3s ease-in-out infinite; }
    
    @keyframes gradientShift {
      0% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
      100% { background-position: 0% 50%; }
    }
    .animate-gradient {
      background-size: 200% 200%;
      animation: gradientShift 5s ease infinite;
    }
    
    /* Modern card hover effects */
    .card-hover { transition: all 0.3s ease; }
    .card-hover:hover {
      transform: translateY(-5px);
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    
    /* Loading spinner animation */
    @keyframes spin { to { transform: rotate(360deg); } }
    .loading-spinner { animation: spin 1s linear infinite; }
    
    /* Toast notification animation */
    @keyframes slideIn {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
    }
    .toast { animation: slideIn 0.3s ease-out forwards; }
    
    /* Scroll progress indicator */
    .progress-bar {
      height: 3px;
      background: #3b82f6;
      width: 0%;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 9999;
      transition: width 0.2s ease;
    }
    
    /* Custom scrollbar */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #f1f1f1; }
    ::-webkit-scrollbar-thumb { background: #3b82f6; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #2563eb; }
    
    /* Back-to-top button */
    .back-to-top { transition: opacity 0.3s ease, transform 0.3s ease; }
    .back-to-top.hidden { opacity: 0; transform: translateY(20px); }

    /* Navbar scrolled state */
    nav#navbar.scrolled {
      background: rgba(15, 23, 42, 0.9); /* bg-slate-900 with higher opacity */
      backdrop-filter: blur(10px);
    }

    /* Mobile menu specific styles */
    #mobileMenu {
      z-index: 40; /* Ensure mobile menu is below the navbar itself but above other content */
      background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 35%, #7c3aed 100%); /* Same as navbar initial background */
    }
    #mobileMenu a {
      color: white;
      display: block;
    }

    /* Tab styles */
    /* Remove @apply: use Tailwind classes directly in HTML.
       Example: 
       <button class="tab-button border-b-2 border-blue-600 text-blue-600 ..."> for active
       <button class="tab-button border-b-2 border-transparent text-gray-600 hover:text-gray-800 ..."> for inactive
    */
    .tab-button.active {
        border-bottom-width: 2px;
        border-color: #2563eb; /* Tailwind blue-600 */
        color: #2563eb;
    }
    .tab-button:not(.active) {
        border-bottom-width: 2px;
        border-color: transparent;
        color: #4b5563; /* Tailwind gray-600 */
    }
    .tab-button:not(.active):hover {
        color: #1f2937; /* Tailwind gray-800 */
    }

    /* Badge/Milestone styles */
    .badge-item {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 1rem;
        background: linear-gradient(135deg, #ffffff 0%, #f3f4f6 100%);
        border-radius: 0.5rem;
        box-shadow: 0 4px 6px rgba(0,0,0,0.05), 0 1.5px 3px rgba(0,0,0,0.03);
        transition: all 0.3s ease;
        color: #1e40af; /* Tailwind blue-800 */
        font-weight: 600;
        text-align: center;
    }
    .badge-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    .badge-item i {
        font-size: 2.25rem; /* Tailwind text-4xl */
        margin-bottom: 0.5rem;
        color: #f59e42; /* Tailwind yellow-500 */
    }
  </style>
</head>
<body class="bg-gray-50">
  <!-- Progress bar for scroll indicator -->
  <div class="progress-bar" id="scrollProgress"></div>

  <!-- Loading spinner -->
  <div id="loading" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full loading-spinner"></div>
  </div>
  
  <!-- Toast notification -->
  <div id="toast" class="fixed bottom-5 right-5 text-white p-4 rounded-lg shadow-lg z-50 hidden toast">
    <div class="flex items-center">
      <i class="fas mr-2"></i>
      <span id="toastMessage"></span>
    </div>
  </div>

  <!-- Edit Profile Modal -->
  <div id="editProfileModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <!-- Modal content wrapper with max-height and overflow-y-auto -->
    <div class="bg-white rounded-lg p-6 max-w-md w-full card-hover flex flex-col max-h-[90vh]">
      <h3 class="text-xl font-bold text-gray-800 mb-4 flex-shrink-0">Edit Profil</h3>
      <div class="overflow-y-auto flex-grow pr-2 -mr-2"> <!-- Added padding-right and negative margin to compensate scrollbar width -->
        <form id="editProfileForm" class="space-y-4">
          <div class="flex justify-center mb-4">
            <img id="profilePhotoPreview" src="https://placehold.co/100x100/F0F4F8/6B7280?text=Foto" alt="Profile Photo" class="w-24 h-24 rounded-full object-cover border-2 border-blue-600 profile-photo">
          </div>
          <div>
            <label for="profilePhoto" class="block text-sm font-medium text-gray-700">Foto Profil</label>
            <input type="file" id="profilePhoto" name="profilePhoto" accept="image/*" class="w-full p-3 mt-1 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-600">
          </div>
          <div>
            <label for="editName" class="block text-sm font-medium text-gray-700">Nama Lengkap</label>
            <input type="text" id="editName" name="editName" class="w-full p-3 mt-1 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-600" required>
          </div>
          <div>
            <label for="editEmail" class="block text-sm font-medium text-gray-700">Email</label>
            <input type="email" id="editEmail" name="editEmail" class="w-full p-3 mt-1 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-600" required>
          </div>
          <div>
            <label for="editPhone" class="block text-sm font-medium text-gray-700">Nomor Telepon</label>
            <input type="text" id="editPhone" name="editPhone" class="w-full p-3 mt-1 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-600">
          </div>
          <div>
            <label for="editUniversityId" class="block text-sm font-medium text-gray-700">ID Universitas (NIM/NIP)</label>
            <input type="text" id="editUniversityId" name="editUniversityId" class="w-full p-3 mt-1 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-600">
          </div>
          <div>
            <label for="editDob" class="block text-sm font-medium text-gray-700">Tanggal Lahir</label>
            <input type="date" id="editDob" name="editDob" class="w-full p-3 mt-1 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-600">
          </div>
          <div>
            <label for="editGender" class="block text-sm font-medium text-gray-700">Jenis Kelamin</label>
            <select id="editGender" name="editGender" class="w-full p-3 mt-1 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-600">
              <option value="">Pilih</option>
              <option value="Laki-laki">Laki-laki</option>
              <option value="Perempuan">Perempuan</option>
            </select>
          </div>
          <div>
            <label for="editAddress" class="block text-sm font-medium text-gray-700">Alamat</label>
            <textarea id="editAddress" name="editAddress" rows="2" class="w-full p-3 mt-1 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-600"></textarea>
          </div>
          <div id="studentFields" class="space-y-4">
              <div>
                <label for="editStudyProgram" class="block text-sm font-medium text-gray-700">Program Studi/Departemen</label>
                <select id="editStudyProgram" name="editStudyProgram" class="w-full p-3 mt-1 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-600">
                  <option value="">Pilih Program Studi</option>
                  <option value="Pendidikan Bahasa Inggris">Pendidikan Bahasa Inggris</option>
                  <option value="Teknik Informatika">Teknik Informatika</option>
                  <option value="Psikologi">Psikologi</option>
                  <option value="Biologi">Biologi</option>
                  <!-- Add more as needed -->
                </select>
              </div>
              <div>
                <label for="editEducationLevel" class="block text-sm font-medium text-gray-700">Tingkat Pendidikan</label>
                <select id="editEducationLevel" name="editEducationLevel" class="w-full p-3 mt-1 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-600">
                  <option value="">Pilih Tingkat Pendidikan</option>
                  <option value="S1">S1</option>
                  <option value="S2">S2</option>
                  <option value="S3">S3</option>
                </select>
              </div>
          </div>
          <div id="teacherFields" class="space-y-4 hidden">
              <div>
                <label for="editFaculty" class="block text-sm font-medium text-gray-700">Fakultas</label>
                <input type="text" id="editFaculty" name="editFaculty" class="w-full p-3 mt-1 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-600">
              </div>
              <div>
                <label for="editDepartment" class="block text-sm font-medium text-gray-700">Jurusan</label>
                <input type="text" id="editDepartment" name="editDepartment" class="w-full p-3 mt-1 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-600">
              </div>
              <div>
                <label for="editTaughtCourses" class="block text-sm font-medium text-gray-700">Mata Kuliah Diajar (dipisahkan koma)</label>
                <input type="text" id="editTaughtCourses" name="editTaughtCourses" class="w-full p-3 mt-1 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-600">
              </div>
          </div>
        </form>
      </div>
      <div class="flex justify-end gap-4 mt-6 flex-shrink-0"> <!-- Buttons remain at bottom -->
        <button type="button" id="cancelEdit" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400 transition-all">Batal</button>
        <button type="submit" form="editProfileForm" class="bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-all">Simpan</button>
      </div>
    </div>
  </div>

  <!-- Change Password Modal -->
  <div id="changePasswordModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg p-6 max-w-md w-full card-hover">
      <h3 class="text-xl font-bold text-gray-800 mb-4">Ubah Kata Sandi</h3>
      <form id="changePasswordForm" class="space-y-4">
        <div>
          <label for="oldPassword" class="block text-sm font-medium text-gray-700">Kata Sandi Lama</label>
          <input type="password" id="oldPassword" class="w-full p-3 mt-1 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-600" required>
        </div>
        <div>
          <label for="newPassword" class="block text-sm font-medium text-gray-700">Kata Sandi Baru</label>
          <input type="password" id="newPassword" class="w-full p-3 mt-1 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-600" required>
        </div>
        <div>
          <label for="confirmNewPassword" class="block text-sm font-medium text-gray-700">Konfirmasi Kata Sandi Baru</label>
          <input type="password" id="confirmNewPassword" class="w-full p-3 mt-1 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-600" required>
        </div>
        <p id="passwordMessage" class="text-sm mt-1"></p>
        <div class="flex justify-end gap-4">
          <button type="button" id="cancelChangePassword" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400 transition-all">Batal</button>
          <button type="submit" class="bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-all">Simpan</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Deactivation Confirmation Modal -->
  <div id="deactivateModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg p-6 max-w-md w-full card-hover">
      <h3 class="text-xl font-bold text-gray-800 mb-4">Konfirmasi Penonaktifan Akun</h3>
      <p class="text-gray-600 mb-6">Apakah Anda yakin ingin **menonaktifkan** akun Anda? Anda dapat mengaktifkannya kembali nanti.</p>
      <div class="flex justify-end gap-4">
        <button id="cancelDeactivate" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400 transition-all">Batal</button>
        <button id="confirmDeactivate" class="bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700 transition-all">Ya, Nonaktifkan</button>
      </div>
    </div>
  </div>

  <!-- Deletion Confirmation Modal -->
  <div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg p-6 max-w-md w-full card-hover">
      <h3 class="text-xl font-bold text-gray-800 mb-4">Konfirmasi Penghapusan Akun</h3>
      <p class="text-gray-600 mb-6 font-bold text-red-700">Peringatan: Data Anda tidak dapat dipulihkan setelah dihapus. Apakah Anda yakin ingin **menghapus** akun Anda secara permanen?</p>
      <div class="flex justify-end gap-4">
        <button id="cancelDelete" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400 transition-all">Batal</button>
        <button id="confirmDelete" class="bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700 transition-all">Ya, Hapus Permanen</button>
      </div>
    </div>
  </div>

  <!-- Logout Confirmation Modal (Existing) -->
  <div id="logoutModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
    <div class="bg-white rounded-lg p-6 max-w-md w-full card-hover">
      <h3 class="text-xl font-bold text-gray-800 mb-4">Konfirmasi Logout</h3>
      <p class="text-gray-600 mb-6">Apakah Anda yakin ingin logout?</p>
      <div class="flex justify-end gap-4">
        <button id="cancelLogout" class="bg-gray-300 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-400 transition-all">Batal</button>
        <button id="confirmLogout" class="bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700 transition-all">Logout</button>
      </div>
    </div>
  </div>

  <!-- Navigation (Consistent with other pages, using 'Modern & Authoritative' logo concept) -->
  <nav class="fixed top-0 w-full z-50 transition-all duration-300 bg-gradient-hero-nav text-white shadow-lg" id="navbar">
    <div class="container mx-auto px-4">
      <div class="flex justify-between items-center py-4">
        <div class="flex items-center space-x-3">
            <div class="w-10 h-10 bg-yellow-300 rounded-lg flex items-center justify-center mr-3 shadow-lg">
                <img src="logo.png" alt="Logo" class="w-8 h-8"> 
            </div>
            <a href="index.html" class="text-3xl font-extrabold text-white hover:opacity-80 transition-opacity">UNNES</a>
            <a href="index.html" class="text-3xl font-medium text-blue-200 hover:opacity-80 transition-opacity">STUDY ZONE</a>
        </div>
        
        <!-- Desktop Menu -->
        <div class="hidden md:flex items-center space-x-6">
          <a href="index.html" class="hover:text-blue-200 transition-colors duration-200 flex items-center">
            <i class="fas fa-home mr-1"></i> Home
          </a>
          <a href="tryout.html" class="hover:text-blue-200 transition-colors duration-200 flex items-center">
            <i class="fas fa-file-alt mr-1"></i> Tryout
          </a>
          <a href="materi.html" class="hover:text-blue-200 transition-colors duration-200 flex items-center">
            <i class="fas fa-book mr-1"></i> Materi
          </a>
          <a href="paket.html" class="hover:text-blue-200 transition-colors duration-200 flex items-center">
            <i class="fas fa-credit-card mr-1"></i> Paket
          </a>
          <a href="akun.html" class="text-yellow-300 transition-colors duration-200 flex items-center">
            <i class="fas fa-user-circle mr-1"></i> Akun
          </a>
          <div class="border-l pl-4 border-blue-400">
            <a href="login.html" class="hover:text-blue-200 transition-colors duration-200 mr-4">
              <i class="fas fa-sign-in-alt mr-1"></i> Login
            </a>
            <a href="register.html" class="bg-yellow-400 text-blue-900 py-2 px-4 rounded-lg font-medium hover:bg-yellow-300 transition-all">
              <i class="fas fa-user-plus mr-1"></i> Sign Up
            </a>
          </div>
        </div>
        
        <!-- Mobile menu button -->
        <div class="md:hidden">
          <button id="menuBtn" class="text-white focus:outline-none">
            <i class="fas fa-bars text-xl"></i>
          </button>
        </div>
      </div>
      
      <!-- Mobile Menu -->
      <div id="mobileMenu" class="md:hidden hidden mobile-menu pb-4">
        <div class="flex flex-col space-y-3">
          <a href="index.html" class="hover:bg-blue-700 py-2 px-4 rounded-md transition-colors">
            <i class="fas fa-home mr-2"></i> Home
          </a>
          <a href="tryout.html" class="hover:bg-blue-700 py-2 px-4 rounded-md transition-colors">
            <i class="fas fa-file-alt mr-2"></i> Tryout
          </a>
          <a href="materi.html" class="hover:bg-blue-700 py-2 px-4 rounded-md transition-colors">
            <i class="fas fa-book mr-2"></i> Materi
          </a>
          <a href="paket.html" class="hover:bg-blue-700 py-2 px-4 rounded-md transition-colors">
            <i class="fas fa-credit-card mr-2"></i> Paket
          </a>
          <a href="akun.html" class="bg-blue-700 py-2 px-4 rounded-md transition-colors">
            <i class="fas fa-user-circle mr-2"></i> Akun
          </a>
          <div class="pt-2 border-t border-blue-400 flex flex-col space-y-2">
            <a href="login.html" class="bg-blue-700 py-2 px-4 rounded-md text-center transition-colors">
              <i class="fas fa-sign-in-alt mr-2"></i> Login
            </a>
            <a href="register.html" class="bg-yellow-400 text-blue-900 py-2 px-4 rounded-md text-center font-medium">
              <i class="fas fa-user-plus mr-2"></i> Sign Up
            </a>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- Hero Section Akun -->
  <section class="bg-gradient-blue animate-gradient text-white py-16 relative overflow-hidden">
    <div class="absolute inset-0 overflow-hidden">
      <div class="absolute -top-20 -left-20 w-40 h-40 bg-blue-400 rounded-full opacity-10"></div>
      <div class="absolute top-20 right-20 w-60 h-60 bg-blue-300 rounded-full opacity-10 animate-float"></div>
      <div class="absolute bottom-10 left-1/3 w-40 h-40 bg-indigo-400 rounded-full opacity-10" style="animation: float 4s ease-in-out infinite;"></div>
    </div>
    
    <div class="container mx-auto px-4 relative z-10 text-center">
      <h1 class="text-4xl md:text-5xl font-bold mb-4">Halaman Akun Anda</h1>
      <p class="text-lg mb-4 text-blue-100 max-w-2xl mx-auto">Kelola profil, lihat riwayat belajar, dan periksa status paket Anda.</p>
      
      <!-- Role Selector (for simulation purposes) -->
      <div class="bg-white bg-opacity-20 rounded-lg p-3 inline-block">
        <label for="roleSelector" class="text-lg font-semibold mr-2">Simulasikan Peran:</label>
        <select id="roleSelector" class="bg-white text-gray-800 rounded-md px-3 py-1 text-base focus:outline-none focus:ring-2 focus:ring-blue-400">
          <option value="student">Mahasiswa</option>
          <option value="teacher">Dosen/Pengajar</option>
          <option value="admin">Administrator</option>
        </select>
      </div>

      <div class="bg-white bg-opacity-20 rounded-lg p-4 inline-block mt-4">
        <p class="text-xl font-semibold">Selamat Datang, <span id="currentUserName">User Dummy</span>!</p>
      </div>
    </div>
  </section>

  <!-- Main Content - Tabs for Account Management -->
  <section class="py-16 bg-gray-100">
    <div class="container mx-auto px-4">
      <div class="bg-white rounded-lg shadow-lg p-6">
        <!-- Tabs Navigation -->
        <div class="flex flex-wrap border-b border-gray-200 mb-6 gap-2">
          <button id="tabProfile" class="tab-button py-3 px-4 md:px-6 text-sm md:text-lg font-medium transition-colors active">
            <i class="fas fa-user mr-2"></i> Profil
          </button>
          <button id="tabPackages" class="tab-button py-3 px-4 md:px-6 text-sm md:text-lg font-medium transition-colors">
            <i class="fas fa-box-open mr-2"></i> Paket Saya
          </button>
          <button id="tabLearningProgress" class="tab-button py-3 px-4 md:px-6 text-sm md:text-lg font-medium transition-colors">
            <i class="fas fa-chart-line mr-2"></i> Kemajuan Belajar
          </button>
          <button id="tabSecurityPrivacy" class="tab-button py-3 px-4 md:px-6 text-sm md:text-lg font-medium transition-colors">
            <i class="fas fa-shield-alt mr-2"></i> Keamanan & Privasi
          </button>
          <button id="tabNotifications" class="tab-button py-3 px-4 md:px-6 text-sm md:text-lg font-medium transition-colors">
            <i class="fas fa-bell mr-2"></i> Preferensi Notifikasi
          </button>
          <!-- Role-specific tabs for Teacher/Admin -->
          <button id="tabTeacherAdminFeatures" class="tab-button py-3 px-4 md:px-6 text-sm md:text-lg font-medium transition-colors hidden">
            <i class="fas fa-chalkboard-teacher mr-2"></i> Fitur Dosen/Admin
          </button>
        </div>

        <!-- Tab Content: Profil -->
        <div id="contentProfile" class="tab-content">
          <h3 class="text-2xl font-bold text-gray-800 mb-6">Informasi Profil</h3>
          <div class="max-w-md mx-auto bg-gradient-card rounded-lg shadow-md p-6">
            <div class="flex items-center justify-center mb-6">
                <img id="profilePhotoDisplay" src="https://placehold.co/100x100/F0F4F8/6B7280?text=Foto" alt="Profile Photo" class="w-24 h-24 rounded-full object-cover border-2 border-blue-600 mr-4 profile-photo">
            </div>
            <div class="space-y-3 text-gray-700">
                <p><i class="fas fa-user-alt w-5 mr-3 text-blue-600"></i> Nama Lengkap: <span id="userNameDisplay" class="font-semibold"></span></p>
                <p><i class="fas fa-envelope w-5 mr-3 text-blue-600"></i> Email: <span id="userEmailDisplay"></span></p>
                <p><i class="fas fa-phone-alt w-5 mr-3 text-blue-600"></i> Telepon: <span id="userPhoneDisplay"></span></p>
                <p><i class="fas fa-id-card w-5 mr-3 text-blue-600"></i> ID Universitas: <span id="userUniversityIdDisplay"></span></p>
                <p><i class="fas fa-calendar-alt w-5 mr-3 text-blue-600"></i> Tanggal Lahir: <span id="userDobDisplay"></span></p>
                <p><i class="fas fa-venus-mars w-5 mr-3 text-blue-600"></i> Jenis Kelamin: <span id="userGenderDisplay"></span></p>
                <p><i class="fas fa-map-marker-alt w-5 mr-3 text-blue-600"></i> Alamat: <span id="userAddressDisplay"></span></p>
                
                <!-- Student Specific Info -->
                <p id="studentStudyProgramDisplay" class="hidden"><i class="fas fa-book-reader w-5 mr-3 text-blue-600"></i> Program Studi: <span id="userStudyProgramDisplay"></span></p>
                <p id="studentEducationLevelDisplay" class="hidden"><i class="fas fa-graduation-cap w-5 mr-3 text-blue-600"></i> Tingkat Pendidikan: <span id="userEducationLevelDisplay"></span></p>

                <!-- Teacher Specific Info -->
                <p id="teacherFacultyDisplay" class="hidden"><i class="fas fa-building w-5 mr-3 text-blue-600"></i> Fakultas: <span id="userFacultyDisplay"></span></p>
                <p id="teacherDepartmentDisplay" class="hidden"><i class="fas fa-sitemap w-5 mr-3 text-blue-600"></i> Jurusan: <span id="userDepartmentDisplay"></span></p>
                <p id="teacherTaughtCoursesDisplay" class="hidden"><i class="fas fa-chalkboard w-5 mr-3 text-blue-600"></i> Mengajar: <span id="userTaughtCoursesDisplay"></span></p>

                <!-- SSO Status -->
                <div class="flex items-center pt-4 border-t border-gray-200 mt-4">
                    <i class="fas fa-link w-5 mr-3 text-green-500"></i>
                    <span class="font-semibold text-green-600">Akun UNNES Terhubung</span>
                    <button class="ml-4 bg-gray-200 text-gray-700 text-sm py-1 px-3 rounded-md hover:bg-gray-300 transition-colors">Logout dari Akun UNNES</button>
                </div>
            </div>
            <div class="mt-8 text-center">
                <button id="editProfileBtn" class="bg-blue-600 text-white py-2 px-6 rounded-lg hover:bg-blue-700 transition-all flex items-center justify-center mx-auto">
                    <i class="fas fa-edit mr-2"></i> Edit Profil
                </button>
            </div>
          </div>
        </div>

        <!-- Tab Content: Paket Saya -->
        <div id="contentPackages" class="tab-content hidden">
          <h3 class="text-2xl font-bold text-gray-800 mb-6">Paket & Langganan Anda</h3>
          <div id="purchasedPackagesContainer" class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <p class="text-gray-600">Anda belum memiliki paket aktif. <a href="paket.html" class="text-blue-600 hover:underline">Beli Paket Sekarang!</a></p>
            <!-- Purchased packages will be loaded here by JS -->
          </div>

          <div id="invoiceHistory" class="mt-10">
            <h4 class="text-xl font-bold text-gray-800 mb-4">Riwayat Invoice</h4>
            <div id="invoiceContainer" class="space-y-4">
                <p class="text-gray-600">Tidak ada riwayat invoice.</p>
                <!-- Invoices will be loaded here by JS -->
            </div>
          </div>
        </div>

        <!-- Tab Content: Kemajuan Belajar -->
        <div id="contentLearningProgress" class="tab-content hidden">
            <h3 class="text-2xl font-bold text-gray-800 mb-6">Kemajuan Belajar & Pencapaian</h3>
            
            <!-- Student/Teacher specific sections -->
            <div id="studentLearningProgress" class="space-y-8">
                <!-- Courses in Progress -->
                <div class="mb-8">
                    <h4 class="text-xl font-bold text-gray-800 mb-4">Kursus dalam Proses</h4>
                    <div id="coursesInProgressContainer" class="space-y-4">
                        <div class="bg-gradient-card p-4 rounded-lg shadow-md flex items-center justify-between">
                            <div>
                                <p class="font-semibold text-gray-800">Dasar-Dasar Penelitian Kualitatif</p>
                                <p class="text-sm text-gray-600">Progres: 75% selesai</p>
                                <p class="text-xs text-gray-500">Terakhir diakses: 18 Juni 2025</p>
                            </div>
                            <button onclick="accessContent('materi.html')" class="bg-blue-500 text-white py-1 px-3 rounded-lg text-sm hover:bg-blue-600">Lanjutkan</button>
                        </div>
                        <div class="bg-gradient-card p-4 rounded-lg shadow-md flex items-center justify-between">
                            <div>
                                <p class="font-semibold text-gray-800">Manajemen Waktu Efektif</p>
                                <p class="text-sm text-gray-600">Progres: 30% selesai</p>
                                <p class="text-xs text-gray-500">Terakhir diakses: 10 Juni 2025</p>
                            </div>
                            <button onclick="accessContent('materi.html')" class="bg-blue-500 text-white py-1 px-3 rounded-lg text-sm hover:bg-blue-600">Lanjutkan</button>
                        </div>
                        <p id="noCoursesInProgress" class="text-gray-600 hidden">Tidak ada kursus dalam proses.</p>
                    </div>
                </div>

                <!-- Completed Lessons -->
                <div class="mb-8">
                    <h4 class="text-xl font-bold text-gray-800 mb-4">Materi/Pelajaran Selesai</h4>
                    <ul id="completedLessonsList" class="list-disc list-inside text-gray-700 space-y-2">
                        <li>Modul 1: Sejarah Perumusan Pancasila (Selesai: 15 Juni 2025)</li>
                        <li>Bab 2: Fungsi dan Limit (Selesai: 12 Juni 2025)</li>
                        <p id="noCompletedLessons" class="text-gray-600 hidden">Tidak ada materi yang ditandai selesai.</p>
                    </ul>
                </div>

                <!-- Quiz Scores -->
                <div class="mb-8">
                    <h4 class="text-xl font-bold text-gray-800 mb-4">Nilai Kuis & Tryout</h4>
                    <div id="quizScoresContainer" class="space-y-4">
                        <div class="bg-gradient-card p-4 rounded-lg shadow-md flex items-center justify-between">
                            <div>
                                <p class="font-semibold text-gray-800">Tryout Pendidikan Pancasila</p>
                                <p class="text-sm text-gray-600">Skor: 85/100 (<span class="text-green-600">Sila Pancasila, Sejarah</span>)</p>
                            </div>
                            <button onclick="accessContent('tryout.html')" class="bg-blue-500 text-white py-1 px-3 rounded-lg text-sm hover:bg-blue-600">Lihat Hasil</button>
                        </div>
                        <div class="bg-gradient-card p-4 rounded-lg shadow-md flex items-center justify-between">
                            <div>
                                <p class="font-semibold text-gray-800">Kuis Mini: Fungsi Matematika</p>
                                <p class="text-sm text-gray-600">Skor: 70/100 (<span class="text-orange-500">Limit, Turunan</span>)</p>
                            </div>
                            <button onclick="accessContent('materi.html')" class="bg-blue-500 text-white py-1 px-3 rounded-lg text-sm hover:bg-blue-600">Lihat Kuis</button>
                        </div>
                        <p id="noQuizScores" class="text-gray-600 hidden">Tidak ada riwayat kuis atau tryout.</p>
                    </div>
                </div>

                <!-- Badges & Milestones -->
                <div class="mb-8">
                    <h4 class="text-xl font-bold text-gray-800 mb-4">Lencana & Pencapaian</h4>
                    <div id="badgesContainer" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4">
                        <div class="badge-item">
                            <i class="fas fa-award"></i>
                            <span>Penyelesaian 3 Kursus</span>
                        </div>
                        <div class="badge-item">
                            <i class="fas fa-star-half-alt"></i>
                            <span>Skor Tryout Sempurna</span>
                        </div>
                        <div class="badge-item">
                            <i class="fas fa-fire"></i>
                            <span>Belajar Harian 7 Hari</span>
                        </div>
                        <div class="badge-item">
                            <i class="fas fa-book-open"></i>
                            <span>Akses 10 Modul</span>
                        </div>
                        <p id="noBadges" class="text-gray-600 hidden col-span-full">Belum ada lencana yang diperoleh.</p>
                    </div>
                </div>

                <!-- Certifications Earned -->
                <div>
                    <h4 class="text-xl font-bold text-gray-800 mb-4">Sertifikat Diperoleh</h4>
                    <div id="certificationsContainer" class="space-y-4">
                        <div class="bg-gradient-card p-4 rounded-lg shadow-md flex items-center justify-between">
                            <div>
                                <p class="font-semibold text-gray-800">Sertifikat Dasar-Dasar Desain Grafis</p>
                                <p class="text-sm text-gray-600">Diterbitkan: 25 Mei 2025</p>
                            </div>
                            <button onclick="downloadDummyPdf('Sertifikat_Desain_Grafis.pdf')" class="bg-green-500 text-white py-1 px-3 rounded-lg text-sm hover:bg-green-600">
                                <i class="fas fa-download mr-1"></i> Unduh PDF Dummy
                            </button>
                        </div>
                        <div class="bg-gradient-card p-4 rounded-lg shadow-md flex items-center justify-between">
                            <div>
                                <p class="font-semibold text-gray-800">Sertifikat Web Programming Lanjut</p>
                                <p class="text-sm text-gray-600">Diterbitkan: 10 April 2025</p>
                            </div>
                            <button onclick="downloadDummyPdf('Sertifikat_Web_Programming.pdf')" class="bg-green-500 text-white py-1 px-3 rounded-lg text-sm hover:bg-green-600">
                                <i class="fas fa-download mr-1"></i> Unduh PDF Dummy
                            </button>
                        </div>
                        <p id="noCertifications" class="text-gray-600 hidden">Belum ada sertifikat yang diperoleh.</p>
                    </div>
                </div>
            </div>

            <!-- Teacher Specific Learning Progress (Hidden by default) -->
            <div id="teacherLearningProgress" class="hidden space-y-8">
                <h4 class="text-xl font-bold text-gray-800 mb-4">Manajemen Progres Mahasiswa</h4>
                <div class="bg-gradient-card p-6 rounded-lg shadow-md">
                    <p class="text-gray-700 mb-2">Sebagai Dosen, Anda dapat melihat progres belajar mahasiswa yang Anda bimbing.</p>
                    <ul class="list-disc list-inside text-gray-700 space-y-2">
                        <li>Daftar Mahasiswa & Progres Kursus</li>
                        <li>Detail Penilaian Tugas & Kuis</li>
                        <li>Fitur Komunikasi dengan Mahasiswa</li>
                    </ul>
                    <button class="mt-4 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700">Akses Dasbor Dosen</button>
                </div>
            </div>

            <!-- Admin Specific Learning Progress (Hidden by default) -->
            <div id="adminLearningProgress" class="hidden space-y-8">
                <h4 class="text-xl font-bold text-gray-800 mb-4">Laporan & Statistik Pembelajaran</h4>
                <div class="bg-gradient-card p-6 rounded-lg shadow-md">
                    <p class="text-gray-700 mb-2">Sebagai Administrator, Anda memiliki akses ke laporan dan statistik seluruh platform.</p>
                    <ul class="list-disc list-inside text-gray-700 space-y-2">
                        <li>Total Pengguna Aktif</li>
                        <li>Kursus Terpopuler</li>
                        <li>Rata-rata Skor Tryout</li>
                        <li>Laporan Pembelian Paket</li>
                    </ul>
                    <button class="mt-4 bg-purple-600 text-white py-2 px-4 rounded-lg hover:bg-purple-700">Akses Dasbor Admin</button>
                </div>
            </div>
        </div>

        <!-- Tab Content: Keamanan & Privasi -->
        <div id="contentSecurityPrivacy" class="tab-content hidden">
            <h3 class="text-2xl font-bold text-gray-800 mb-6">Pengaturan Keamanan & Privasi</h3>
            <div class="space-y-6">
                <!-- Privacy Settings -->
                <div class="bg-gradient-card p-6 rounded-lg shadow-md">
                    <h4 class="text-xl font-bold text-gray-800 mb-4">Pengaturan Privasi</h4>
                    <div class="flex items-center justify-between mb-4">
                        <label for="emailNotificationsToggle" class="text-gray-700">Notifikasi Email:</label>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="emailNotificationsToggle" class="sr-only peer" checked>
                            <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:border-gray-300 after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                        </label>
                    </div>
                    <div class="flex items-center justify-between mb-4">
                        <label for="publicProfileVisibilityToggle" class="text-gray-700">Profil Publik Terlihat:</label>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="publicProfileVisibilityToggle" class="sr-only peer">
                            <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:border-gray-300 after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                        </label>
                    </div>
                    <button id="exportDataBtn" class="bg-gray-200 text-gray-800 py-2 px-4 rounded-lg hover:bg-gray-300 transition-colors">
                        <i class="fas fa-file-export mr-2"></i> Ekspor Data Pribadi (JSON/CSV)
                    </button>
                </div>

                <!-- Security Settings -->
                <div class="bg-gradient-card p-6 rounded-lg shadow-md">
                    <h4 class="text-xl font-bold text-gray-800 mb-4">Pengaturan Keamanan</h4>
                    <div class="mb-4">
                        <p class="text-gray-700 mb-2">Riwayat Login Terakhir:</p>
                        <ul class="list-disc list-inside text-gray-600 ml-4">
                            <li>2025-06-20, 10:30 WIB, Jakarta, Chrome</li>
                            <li>2025-06-19, 22:15 WIB, Surabaya, Firefox</li>
                        </ul>
                    </div>
                    <button id="changePasswordBtn" class="bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors mr-3">
                        <i class="fas fa-lock mr-2"></i> Ubah Kata Sandi
                    </button>
                    <div class="inline-flex items-center mt-4">
                        <span id="twoFactorAuthStatus" class="ml-2 text-sm font-semibold text-red-500"><span id="twoFactorAuthText">Tidak Aktif</span> <i id="twoFactorAuthIcon" class="fas fa-times-circle"></i></span>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="twoFactorAuthToggle" class="sr-only peer">
                            <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:border-gray-300 after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                        </label>
                    </div>
                </div>

                <!-- Account Management -->
                <div class="bg-red-50 border-l-4 border-red-400 p-6 rounded-md">
                    <h4 class="text-xl font-bold text-red-700 mb-4">Manajemen Akun</h4>
                    <p class="text-gray-700 mb-4">Opsi ini akan menonaktifkan atau menghapus akun Anda. Harap berhati-hati.</p>
                    <button id="deactivateAccountBtn" class="bg-orange-500 text-white py-2 px-4 rounded-lg hover:bg-orange-600 transition-colors mr-3">
                        <i class="fas fa-user-slash mr-2"></i> Deaktivasi Akun
                    </button>
                    <button id="deleteAccountBtn" class="bg-red-600 text-white py-2 px-4 rounded-lg hover:bg-red-700 transition-colors">
                        <i class="fas fa-trash-alt mr-2"></i> Hapus Akun Permanen
                    </button>
                </div>
            </div>
        </div>

        <!-- Tab Content: Preferensi Notifikasi -->
        <div id="contentNotifications" class="tab-content hidden">
            <h3 class="text-2xl font-bold text-gray-800 mb-6">Preferensi Notifikasi</h3>
            <div class="bg-gradient-card p-6 rounded-lg shadow-md space-y-4">
                <p class="text-gray-700 mb-4">Pilih jenis notifikasi yang ingin Anda terima:</p>
                <div class="flex items-center justify-between">
                    <label for="togglePlatformUpdates" class="text-gray-700">Pembaruan Platform:</label>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="togglePlatformUpdates" class="sr-only peer" checked>
                        <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:border-gray-300 after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                    </label>
                </div>
                <div class="flex items-center justify-between">
                    <label for="toggleCourseAnnouncements" class="text-gray-700">Pengumuman Kursus:</label>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="toggleCourseAnnouncements" class="sr-only peer" checked>
                        <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:border-gray-300 after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                    </label>
                </div>
                <div class="flex items-center justify-between">
                    <label for="toggleNewMessages" class="text-gray-700">Pesan Baru:</label>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="toggleNewMessages" class="sr-only peer" checked>
                        <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:border-gray-300 after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                    </label>
                </div>
                <div class="flex items-center justify-between">
                    <label for="toggleNewMaterialRecommendations" class="text-gray-700">Rekomendasi Materi Baru:</label>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="toggleNewMaterialRecommendations" class="sr-only peer" checked>
                        <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:border-gray-300 after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                    </label>
                </div>
                <div class="flex items-center justify-between">
                    <label for="toggleDeadlineReminders" class="text-gray-700">Pengingat Tenggat Waktu Tugas/Kuis:</label>
                    <label class="relative inline-flex items-center cursor-pointer">
                        <input type="checkbox" id="toggleDeadlineReminders" class="sr-only peer" checked>
                        <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 dark:peer-focus:ring-blue-800 dark:bg-gray-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border after:border-gray-300 after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-gray-600 peer-checked:bg-blue-600"></div>
                    </label>
                </div>
                <div class="mt-6 text-center">
                    <button id="saveNotificationPreferencesBtn" class="bg-blue-600 text-white py-2 px-6 rounded-lg hover:bg-blue-700 transition-all">
                        <i class="fas fa-save mr-2"></i> Simpan Preferensi
                    </button>
                </div>
            </div>
        </div>

        <!-- Tab Content: Fitur Dosen/Admin (Hidden by default, shown by role selector) -->
        <div id="contentTeacherAdminFeatures" class="tab-content hidden">
            <h3 id="teacherAdminFeatureTitle" class="text-2xl font-bold text-gray-800 mb-6">Fitur Dosen/Admin</h3>
            <div id="teacherFeaturesContent" class="hidden">
                <div class="bg-gradient-card p-6 rounded-lg shadow-md mb-6">
                    <h4 class="text-xl font-bold text-gray-800 mb-4">Manajemen Kelas & Penilaian</h4>
                    <p class="text-gray-700 mb-4">Sebagai dosen, Anda dapat:</p>
                    <ul class="list-disc list-inside text-gray-700 space-y-2">
                        <li>Mengelola mata kuliah yang diajarkan.</li>
                        <li>Melihat daftar mahasiswa bimbingan dan progres belajar mereka.</li>
                        <li>Menilai tugas dan kuis yang diserahkan mahasiswa.</li>
                        <li>Menerbitkan pengumuman kursus.</li>
                        <li>Mengeluarkan sertifikat kelulusan.</li>
                    </ul>
                    <button class="mt-4 bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition-colors">
                        <i class="fas fa-chalkboard mr-2"></i> Akses Dasbor Dosen
                    </button>
                </div>
                <!-- Example: List of students -->
                <h4 class="text-xl font-bold text-gray-800 mb-4">Mahasiswa Bimbingan</h4>
                <div class="space-y-3">
                    <div class="bg-gray-50 p-4 rounded-lg shadow-sm flex justify-between items-center">
                        <span>Mahasiswa A - Teknik Informatika (Progres: 70%)</span>
                        <button class="text-blue-600 hover:underline text-sm">Lihat Detail</button>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg shadow-sm flex justify-between items-center">
                        <span>Mahasiswa B - Pendidikan Bahasa Inggris (Progres: 90%)</span>
                        <button class="text-blue-600 hover:underline text-sm">Lihat Detail</button>
                    </div>
                </div>
            </div>
            
            <div id="adminFeaturesContent" class="hidden">
                <div class="bg-gradient-card p-6 rounded-lg shadow-md mb-6">
                    <h4 class="text-xl font-bold text-gray-800 mb-4">Manajemen Sistem & Laporan</h4>
                    <p class="text-gray-700 mb-4">Sebagai administrator, Anda dapat:</p>
                    <ul class="list-disc list-inside text-gray-700 space-y-2">
                        <li>Mengelola semua akun pengguna (Mahasiswa, Dosen, Admin).</li>
                        <li>Menambah, mengedit, atau menghapus konten pembelajaran.</li>
                        <li>Melihat laporan transaksi dan statistik penggunaan platform.</li>
                        <li>Mengelola kode promo dan pengaturan pembayaran.</li>
                        <li>Mengatur izin dan peran pengguna.</li>
                    </ul>
                    <button class="mt-4 bg-purple-600 text-white py-2 px-4 rounded-lg hover:bg-purple-700 transition-colors">
                        <i class="fas fa-cogs mr-2"></i> Akses Panel Admin
                    </button>
                </div>
                <!-- Example: Quick Stats -->
                <h4 class="text-xl font-bold text-gray-800 mb-4">Statistik Global</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                        <p class="text-gray-700">Total Pengguna:</p>
                        <p class="text-2xl font-bold text-blue-600">1,250</p>
                    </div>
                    <div class="bg-gray-50 p-4 rounded-lg shadow-sm">
                        <p class="text-gray-700">Paket Terjual Bulan Ini:</p>
                        <p class="text-2xl font-bold text-green-600">85</p>
                    </div>
                </div>
            </div>
        </div>

      </div>
    </div>
  </section>

  <!-- Logout Section -->
  <section class="py-8 bg-gray-100">
    <div class="container mx-auto px-4 text-center">
      <button id="logoutBtn" class="bg-red-600 text-white py-3 px-8 rounded-lg font-semibold hover:bg-red-700 transition-all transform hover:scale-105">
        <i class="fas fa-sign-out-alt mr-2"></i> Logout
      </button>
    </div>
  </section>

  <!-- Footer (Consistent with other pages) -->
  <footer class="bg-gray-900 text-white pt-16 pb-8">
    <div class="container mx-auto px-4">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-12 mb-12">
        <div>
          <div class="flex items-center mb-6">
            <div class="w-10 h-10 bg-yellow-300 rounded-lg flex items-center justify-center mr-3 shadow-lg">
                <img src="logo.png" alt="Logo" class="w-8 h-8"> 
            </div>
            <span class="text-xl font-bold">UNNES STUDY ZONE</span>
          </div>
          <p class="text-gray-400 mb-4">
            Platform persiapan UTS & UAS Online #1 di Indonesia untuk mahasiswa.
          </p>
          <div class="flex space-x-4">
            <a href="#" class="text-gray-400 hover:text-white transition-colors duration-300">
              <i class="fab fa-instagram text-xl"></i>
            </a>
            <a href="#" class="text-gray-400 hover:text-white transition-colors duration-300">
              <i class="fab fa-twitter text-xl"></i>
            </a>
            <a href="#" class="text-gray-400 hover:text-white transition-colors duration-300">
              <i class="fab fa-facebook text-xl"></i>
            </a>
            <a href="#" class="text-gray-400 hover:text-white transition-colors duration-300">
              <i class="fab fa-youtube text-xl"></i>
            </a>
          </div>
        </div>
        
        <div>
          <h3 class="text-lg font-semibold mb-6">Menu</h3>
          <ul class="space-y-3">
            <li><a href="index.html" class="text-gray-400 hover:text-white transition-colors duration-300">Home</a></li>
            <li><a href="index.html#features" class="text-gray-400 hover:text-white transition-colors duration-300">Features</a></li>
            <li><a href="index.html#subjects" class="text-gray-400 hover:text-white transition-colors duration-300">Subjects</a></li>
            <li><a href="index.html#packages" class="text-gray-400 hover:text-white transition-colors duration-300">Packages</a></li>
            <li><a href="login.html" class="text-gray-400 hover:text-white transition-colors duration-300">Account</a></li>
          </ul>
        </div>
        
        <div>
          <h3 class="text-lg font-semibold mb-6">Bantuan</h3>
          <ul class="space-y-3">
            <li><a href="#" class="text-gray-400 hover:text-white transition-colors duration-300">FAQ</a></li>
            <li><a href="#" class="text-gray-400 hover:text-white transition-colors duration-300">Kontak Kami</a></li>
            <li><a href="#" class="text-gray-400 hover:text-white transition-colors duration-300">Kebijakan Privasi</a></li>
            <li><a href="#" class="text-gray-400 hover:text-white transition-colors duration-300">Syarat & Ketentuan</a></li>
          </ul>
        </div>
        
        <div>
          <h3 class="text-lg font-semibold mb-6">Kontak</h3>
          <ul class="space-y-3 text-gray-400">
            <li class="flex items-start">
              <i class="fas fa-map-marker-alt mt-1 mr-3"></i>
              <span>Jl. Pendidikan No. 1, Semarang, Jawa Tengah</span>
            </li>
            <li class="flex items-start">
              <i class="fas fa-envelope mt-1 mr-3"></i>
              <span>hello@unnesstudyzone.com</span>
            </li>
            <li class="flex items-start">
              <i class="fas fa-phone-alt mt-1 mr-3"></i>
              <span>(024) 1234 5678</span>
            </li>
            <li class="flex items-start">
              <i class="fab fa-whatsapp mt-1 mr-3"></i>
              <span>+62 812 3456 7890</span>
            </li>
          </ul>
        </div>
      </div>
      
      <div class="border-t border-gray-800 pt-8 text-center text-gray-500">
        <p>© 2025 UNNES STUDY ZONE. All rights reserved.</p>
      </div>
    </div>
  </footer>

  <!-- Back-to-Top Button -->
  <button id="backToTop" class="fixed bottom-5 right-5 bg-blue-600 text-white p-3 rounded-full shadow-lg hover:bg-blue-700 transition-all back-to-top hidden">
    <i class="fas fa-arrow-up"></i>
  </button>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
  <script>
    // Initialize AOS
    AOS.init({ duration: 800, once: true });

    // --- Global Utility Functions ---
    function showElement(element) { if (element) element.classList.remove('hidden'); }
    function hideElement(element) { if (element) element.classList.add('hidden'); }
    function showToastNotification(message, type = 'success') {
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toastMessage');
      const toastIcon = toast.querySelector('i');

      if (!toast || !toastMessage || !toastIcon) {
          console.error("Toast elements not found!");
          return;
      }

      toastMessage.textContent = message;
      toast.classList.remove('bg-green-500', 'bg-red-500', 'bg-blue-500'); // Clear previous types
      toastIcon.classList.remove('fa-check-circle', 'fa-times-circle', 'fa-info-circle');

      if (type === 'success') {
        toast.classList.add('bg-green-500');
        toastIcon.classList.add('fa-check-circle');
      } else if (type === 'error') {
        toast.classList.add('bg-red-500');
        toastIcon.classList.add('fa-times-circle');
      } else if (type === 'info') {
        toast.classList.add('bg-blue-500');
        toastIcon.classList.add('fa-info-circle');
      }
      
      toast.classList.remove('hidden');
      setTimeout(() => { toast.classList.add('hidden'); }, 3000);
    }

    // --- User Data Simulation (Initial State and Placeholder for different roles) ---
    const usersData = {
        'student': {
            role: 'student',
            name: 'Mahasiswa UNNES',
            email: 'mahasiswa@unnes.ac.id',
            phone: '081234567890',
            universityId: '20220101001',
            profilePhoto: 'https://placehold.co/100x100/F0F4F8/6B7280?text=S',
            dob: '2003-05-15',
            gender: 'Laki-laki',
            address: 'Jl. Pemuda No. 10, Semarang',
            studyProgram: 'Teknik Informatika',
            educationLevel: 'S1',
            privacy: {
                emailNotifications: true,
                publicProfile: false
            },
            notifications: {
                platformUpdates: true,
                courseAnnouncements: true,
                newMessages: true,
                newMaterialRecommendations: true,
                deadlineReminders: true
            },
            learningProgress: {
                coursesInProgress: [
                    { name: 'Dasar-Dasar Penelitian Kualitatif', progress: 75, lastAccessed: '18 Juni 2025', link: 'materi.html' },
                    { name: 'Manajemen Waktu Efektif', progress: 30, lastAccessed: '10 Juni 2025', link: 'materi.html' }
                ],
                completedLessons: [
                    'Modul 1: Sejarah Perumusan Pancasila (Selesai: 15 Juni 2025)',
                    'Bab 2: Fungsi dan Limit (Selesai: 12 Juni 2025)'
                ],
                quizScores: [
                    { name: 'Tryout Pendidikan Pancasila', score: '85/100', topics: 'Sila Pancasila, Sejarah', link: 'tryout.html' },
                    { name: 'Kuis Mini: Fungsi Matematika', score: '70/100', topics: 'Limit, Turunan', link: 'materi.html' }
                ],
                badges: [
                    { name: 'Penyelesaian 3 Kursus', icon: 'fas fa-award' },
                    { name: 'Skor Tryout Sempurna', icon: 'fas fa-star-half-alt' },
                    { name: 'Belajar Harian 7 Hari', icon: 'fas fa-fire' },
                    { name: 'Akses 10 Modul', icon: 'fas fa-book-open' }
                ],
                certifications: [
                    { name: 'Sertifikat Dasar-Dasar Desain Grafis', issuedDate: '25 Mei 2025', filename: 'Sertifikat_Desain_Grafis.pdf' },
                    { name: 'Sertifikat Web Programming Lanjut', issuedDate: '10 April 2025', filename: 'Sertifikat_Web_Programming.pdf' }
                ]
            }
        },
        'teacher': {
            role: 'teacher',
            name: 'Dosen Pengajar',
            email: 'dosen@unnes.ac.id',
            phone: '081298765432',
            universityId: '198009092005011001', // NIP
            profilePhoto: 'https://placehold.co/100x100/F0F4F8/6B7280?text=D',
            dob: '1980-09-09',
            gender: 'Perempuan',
            address: 'Jl. Dosen No. 5, Semarang',
            faculty: 'Fakultas Ilmu Komputer',
            department: 'Jurusan Teknik Informatika',
            taughtCourses: 'Algoritma & Struktur Data, Basis Data, Pemrograman Web',
            privacy: {
                emailNotifications: true,
                publicProfile: true
            },
            notifications: {
                platformUpdates: true,
                courseAnnouncements: true,
                newMessages: true,
                newMaterialRecommendations: false, // Less relevant for teachers
                deadlineReminders: true
            },
            learningProgress: {} // Teachers don't have this view as students
        },
        'admin': {
            role: 'admin',
            name: 'Administrator Sistem',
            email: 'admin@unnes.ac.id',
            phone: '081122334455',
            universityId: 'ADM2024001',
            profilePhoto: 'https://placehold.co/100x100/F0F4F8/6B7280?text=A',
            dob: '1975-01-01',
            gender: 'Laki-laki',
            address: 'Kantor Pusat UNNES, Semarang',
            privacy: {
                emailNotifications: true,
                publicProfile: false
            },
            notifications: {
                platformUpdates: true,
                courseAnnouncements: true,
                newMessages: true,
                newMaterialRecommendations: true,
                deadlineReminders: true
            },
            learningProgress: {} // Admins don't have this view as students
        }
    };

    let currentUserRole = 'student'; // Default role
    let currentProfileData = {}; // Data for the currently selected role

    // --- DOM Elements ---
    const mobileMenu = document.getElementById('mobileMenu');
    const menuBtn = document.getElementById('menuBtn');
    const scrollProgress = document.getElementById('scrollProgress');
    const backToTop = document.getElementById('backToTop');
    const loadingScreen = document.getElementById('loading');
    const navbar = document.getElementById('navbar');

    const roleSelector = document.getElementById('roleSelector');
    const currentUserNameDisplay = document.getElementById('currentUserName');

    // Tabs
    const tabProfile = document.getElementById('tabProfile');
    const tabPackages = document.getElementById('tabPackages');
    const tabLearningProgress = document.getElementById('tabLearningProgress');
    const tabSecurityPrivacy = document.getElementById('tabSecurityPrivacy');
    const tabNotifications = document.getElementById('tabNotifications');
    const tabTeacherAdminFeatures = document.getElementById('tabTeacherAdminFeatures');

    const contentProfile = document.getElementById('contentProfile');
    const contentPackages = document.getElementById('contentPackages');
    const contentLearningProgress = document.getElementById('contentLearningProgress');
    const contentSecurityPrivacy = document.getElementById('contentSecurityPrivacy');
    const contentNotifications = document.getElementById('contentNotifications');
    const contentTeacherAdminFeatures = document.getElementById('contentTeacherAdminFeatures');

    // Profile Tab Elements
    const profilePhotoDisplay = document.getElementById('profilePhotoDisplay');
    const userNameDisplay = document.getElementById('userNameDisplay');
    const userEmailDisplay = document.getElementById('userEmailDisplay');
    const userPhoneDisplay = document.getElementById('userPhoneDisplay');
    const userUniversityIdDisplay = document.getElementById('userUniversityIdDisplay');
    const userDobDisplay = document.getElementById('userDobDisplay');
    const userGenderDisplay = document.getElementById('userGenderDisplay');
    const userAddressDisplay = document.getElementById('userAddressDisplay');
    const userStudyProgramDisplay = document.getElementById('userStudyProgramDisplay');
    const userEducationLevelDisplay = document.getElementById('userEducationLevelDisplay');
    const studentStudyProgramDisplay = document.getElementById('studentStudyProgramDisplay');
    const studentEducationLevelDisplay = document.getElementById('studentEducationLevelDisplay');

    const userFacultyDisplay = document.getElementById('userFacultyDisplay');
    const userDepartmentDisplay = document.getElementById('userDepartmentDisplay');
    const userTaughtCoursesDisplay = document.getElementById('userTaughtCoursesDisplay');
    const teacherFacultyDisplay = document.getElementById('teacherFacultyDisplay');
    const teacherDepartmentDisplay = document.getElementById('teacherDepartmentDisplay');
    const teacherTaughtCoursesDisplay = document.getElementById('teacherTaughtCoursesDisplay');

    // Edit Profile Modal Elements
    const editProfileBtn = document.getElementById('editProfileBtn');
    const editProfileModal = document.getElementById('editProfileModal');
    const cancelEdit = document.getElementById('cancelEdit');
    const editProfileForm = document.getElementById('editProfileForm');
    const profilePhotoInput = document.getElementById('profilePhoto');
    const profilePhotoPreview = document.getElementById('profilePhotoPreview');
    const editName = document.getElementById('editName');
    const editEmail = document.getElementById('editEmail');
    const editPhone = document.getElementById('editPhone');
    const editUniversityId = document.getElementById('editUniversityId');
    const editDob = document.getElementById('editDob');
    const editGender = document.getElementById('editGender');
    const editAddress = document.getElementById('editAddress');
    const editStudyProgram = document.getElementById('editStudyProgram');
    const editEducationLevel = document.getElementById('editEducationLevel');
    const studentFields = document.getElementById('studentFields');
    const teacherFields = document.getElementById('teacherFields');
    const editFaculty = document.getElementById('editFaculty');
    const editDepartment = document.getElementById('editDepartment');
    const editTaughtCourses = document.getElementById('editTaughtCourses');

    // Packages Tab Elements
    const purchasedPackagesContainer = document.getElementById('purchasedPackagesContainer');
    const invoiceContainer = document.getElementById('invoiceContainer');

    // Learning Progress Tab Elements
    const studentLearningProgress = document.getElementById('studentLearningProgress');
    const teacherLearningProgress = document.getElementById('teacherLearningProgress');
    const adminLearningProgress = document.getElementById('adminLearningProgress');
    const coursesInProgressContainer = document.getElementById('coursesInProgressContainer');
    const completedLessonsList = document.getElementById('completedLessonsList');
    const quizScoresContainer = document.getElementById('quizScoresContainer');
    const badgesContainer = document.getElementById('badgesContainer');
    const certificationsContainer = document.getElementById('certificationsContainer');
    const noCoursesInProgress = document.getElementById('noCoursesInProgress');
    const noCompletedLessons = document.getElementById('noCompletedLessons');
    const noQuizScores = document.getElementById('noQuizScores');
    const noBadges = document.getElementById('noBadges');
    const noCertifications = document.getElementById('noCertifications');


    // Security & Privacy Tab Elements
    const emailNotificationsToggle = document.getElementById('emailNotificationsToggle');
    const publicProfileVisibilityToggle = document.getElementById('publicProfileVisibilityToggle');
    const exportDataBtn = document.getElementById('exportDataBtn');
    const changePasswordBtn = document.getElementById('changePasswordBtn');
    const changePasswordModal = document.getElementById('changePasswordModal');
    const cancelChangePassword = document.getElementById('cancelChangePassword');
    const changePasswordForm = document.getElementById('changePasswordForm');
    const oldPassword = document.getElementById('oldPassword');
    const newPassword = document.getElementById('newPassword');
    const confirmNewPassword = document.getElementById('confirmNewPassword');
    const passwordMessage = document.getElementById('passwordMessage');
    const twoFactorAuthToggle = document.getElementById('twoFactorAuthToggle');
    const twoFactorAuthStatus = document.getElementById('twoFactorAuthStatus');
    const twoFactorAuthText = document.getElementById('twoFactorAuthText'); // New element for text part
    const twoFactorAuthIcon = document.getElementById('twoFactorAuthIcon'); // New element for icon part
    const deactivateAccountBtn = document.getElementById('deactivateAccountBtn');
    const deleteAccountBtn = document.getElementById('deleteAccountBtn');
    const deactivateModal = document.getElementById('deactivateModal');
    const deleteModal = document.getElementById('deleteModal');
    const cancelDeactivate = document.getElementById('cancelDeactivate');
    const confirmDeactivate = document.getElementById('confirmDeactivate');
    const cancelDelete = document.getElementById('cancelDelete');
    const confirmDelete = document.getElementById('confirmDelete');

    // Notifications Tab Elements
    const togglePlatformUpdates = document.getElementById('togglePlatformUpdates');
    const toggleCourseAnnouncements = document.getElementById('toggleCourseAnnouncements');
    const toggleNewMessages = document.getElementById('toggleNewMessages');
    const toggleNewMaterialRecommendations = document.getElementById('toggleNewMaterialRecommendations');
    const toggleDeadlineReminders = document.getElementById('toggleDeadlineReminders');
    const saveNotificationPreferencesBtn = document.getElementById('saveNotificationPreferencesBtn');

    // Teacher/Admin Features Tab Elements
    const teacherAdminFeatureTitle = document.getElementById('teacherAdminFeatureTitle');
    const teacherFeaturesContent = document.getElementById('teacherFeaturesContent');
    const adminFeaturesContent = document.getElementById('adminFeaturesContent');

    // Logout Modal Elements (existing)
    const logoutBtn = document.getElementById('logoutBtn');
    const logoutModal = document.getElementById('logoutModal');
    const cancelLogout = document.getElementById('cancelLogout');
    const confirmLogout = document.getElementById('confirmLogout');


    // --- Functions ---

    // Function to load user data based on role
    function loadUserData(role) {
        currentProfileData = { ...usersData[role] }; // Copy data to current profile
        if (currentUserNameDisplay) {
          currentUserNameDisplay.textContent = currentProfileData.name;
        }
        
        // Load data from localStorage if available (simulating persistence for profile and packages)
        const storedProfile = JSON.parse(localStorage.getItem(`userProfile_${role}`) || '{}');
        Object.assign(currentProfileData, storedProfile); // Merge stored data

        // Set role-specific visibility for main tab buttons
        updateTabVisibility(role);

        // Render content for the active tab after user data is loaded
        // Default to 'Profil' tab
        switchTab('profile'); 
    }

    // Function to update tab visibility based on role
    function updateTabVisibility(role) {
        // Hide all role-specific content divs first
        hideElement(studentLearningProgress);
        hideElement(teacherLearningProgress);
        hideElement(adminLearningProgress);
        if (tabTeacherAdminFeatures) { // Ensure element exists before manipulating
          hideElement(tabTeacherAdminFeatures);
          tabTeacherAdminFeatures.textContent = ''; // Clear text if it somehow appears for student
        }
        hideElement(teacherFeaturesContent);
        hideElement(adminFeaturesContent);

        // Show/hide main tabs if needed (though for now, all main tabs are common)
        // Adjust display properties for different roles on 'Kemajuan Belajar' tab
        if (role === 'student') {
            showElement(studentLearningProgress);
        } else if (role === 'teacher') {
            showElement(teacherLearningProgress);
            if (tabTeacherAdminFeatures) {
                showElement(tabTeacherAdminFeatures);
                teacherAdminFeatureTitle.textContent = 'Fitur Dosen';
                showElement(teacherFeaturesContent);
            }
            hideElement(adminFeaturesContent);
        } else if (role === 'admin') {
            showElement(adminLearningProgress);
            if (tabTeacherAdminFeatures) {
                showElement(tabTeacherAdminFeatures);
                teacherAdminFeatureTitle.textContent = 'Fitur Administrator';
                showElement(adminFeaturesContent);
            }
            hideElement(teacherFeaturesContent);
        }
    }

    // Function to update the displayed profile information
    function updateProfileDisplay() {
        if (!profilePhotoDisplay || !userNameDisplay || !userEmailDisplay || !userPhoneDisplay || !userUniversityIdDisplay || !userDobDisplay || !userGenderDisplay || !userAddressDisplay) {
            console.warn("One or more profile display elements not found. Skipping update.");
            return;
        }

        profilePhotoDisplay.src = currentProfileData.profilePhoto || 'https://placehold.co/100x100/F0F4F8/6B7280?text=Foto';
        userNameDisplay.textContent = currentProfileData.name;
        userEmailDisplay.textContent = currentProfileData.email;
        userPhoneDisplay.textContent = currentProfileData.phone || '-';
        userUniversityIdDisplay.textContent = currentProfileData.universityId || '-';
        userDobDisplay.textContent = currentProfileData.dob || '-';
        userGenderDisplay.textContent = currentProfileData.gender || '-';
        userAddressDisplay.textContent = currentProfileData.address || '-';

        // Student-specific fields
        if (currentProfileData.role === 'student') {
            if (studentStudyProgramDisplay) showElement(studentStudyProgramDisplay);
            if (studentEducationLevelDisplay) showElement(studentEducationLevelDisplay);
            if (teacherFacultyDisplay) hideElement(teacherFacultyDisplay);
            if (teacherDepartmentDisplay) hideElement(teacherDepartmentDisplay);
            if (teacherTaughtCoursesDisplay) hideElement(teacherTaughtCoursesDisplay);

            if (userStudyProgramDisplay) userStudyProgramDisplay.textContent = currentProfileData.studyProgram || '-';
            if (userEducationLevelDisplay) userEducationLevelDisplay.textContent = currentProfileData.educationLevel || '-';
        } 
        // Teacher-specific fields
        else if (currentProfileData.role === 'teacher') {
            if (studentStudyProgramDisplay) hideElement(studentStudyProgramDisplay);
            if (studentEducationLevelDisplay) hideElement(studentEducationLevelDisplay);
            if (teacherFacultyDisplay) showElement(teacherFacultyDisplay);
            if (teacherDepartmentDisplay) showElement(teacherDepartmentDisplay);
            if (teacherTaughtCoursesDisplay) showElement(teacherTaughtCoursesDisplay);

            if (userFacultyDisplay) userFacultyDisplay.textContent = currentProfileData.faculty || '-';
            if (userDepartmentDisplay) userDepartmentDisplay.textContent = currentProfileData.department || '-';
            if (userTaughtCoursesDisplay) userTaughtCoursesDisplay.textContent = currentProfileData.taughtCourses || '-';
        }
        // Admin role has no specific profile fields beyond common ones for this prototype
        else if (currentProfileData.role === 'admin') {
            if (studentStudyProgramDisplay) hideElement(studentStudyProgramDisplay);
            if (studentEducationLevelDisplay) hideElement(studentEducationLevelDisplay);
            if (teacherFacultyDisplay) hideElement(teacherFacultyDisplay);
            if (teacherDepartmentDisplay) hideElement(teacherDepartmentDisplay);
            if (teacherTaughtCoursesDisplay) hideElement(teacherTaughtCoursesDisplay);
        }
    }

    // Populate edit profile modal with current data
    function populateEditProfileModal() {
        if (!profilePhotoPreview || !editName || !editEmail || !editPhone || !editUniversityId || !editDob || !editGender || !editAddress) {
            console.warn("One or more edit profile modal elements not found. Skipping populate.");
            return;
        }

        profilePhotoPreview.src = profilePhotoDisplay.src;
        editName.value = currentProfileData.name;
        editEmail.value = currentProfileData.email;
        editPhone.value = currentProfileData.phone || '';
        editUniversityId.value = currentProfileData.universityId || '';
        editDob.value = currentProfileData.dob || '';
        editGender.value = currentProfileData.gender || '';
        editAddress.value = currentProfileData.address || '';

        // Show/hide role-specific fields in edit modal
        if (currentProfileData.role === 'student') {
            if (studentFields) showElement(studentFields);
            if (teacherFields) hideElement(teacherFields);
            if (editStudyProgram) editStudyProgram.value = currentProfileData.studyProgram || '';
            if (editEducationLevel) editEducationLevel.value = currentProfileData.educationLevel || '';
        } else if (currentProfileData.role === 'teacher') {
            if (studentFields) hideElement(studentFields);
            if (teacherFields) showElement(teacherFields);
            if (editFaculty) editFaculty.value = currentProfileData.faculty || '';
            if (editDepartment) editDepartment.value = currentProfileData.department || '';
            if (editTaughtCourses) editTaughtCourses.value = currentProfileData.taughtCourses || '';
        } else { // Admin role
            if (studentFields) hideElement(studentFields);
            if (teacherFields) hideElement(teacherFields);
        }
    }

    // Save profile changes (simulated)
    function saveProfileChanges(e) {
        e.preventDefault();
        // Check if elements exist before accessing their values
        if (!editName || !editEmail) {
            console.error("Missing essential profile edit fields.");
            showToastNotification('Gagal menyimpan profil: Form tidak lengkap.', 'error');
            return;
        }
        currentProfileData.name = editName.value;
        currentProfileData.email = editEmail.value;
        currentProfileData.phone = editPhone ? editPhone.value : '';
        currentProfileData.universityId = editUniversityId ? editUniversityId.value : '';
        currentProfileData.dob = editDob ? editDob.value : '';
        currentProfileData.gender = editGender ? editGender.value : '';
        currentProfileData.address = editAddress ? editAddress.value : '';

        if (currentProfileData.role === 'student') {
            currentProfileData.studyProgram = editStudyProgram ? editStudyProgram.value : '';
            currentProfileData.educationLevel = editEducationLevel ? editEducationLevel.value : '';
        } else if (currentProfileData.role === 'teacher') {
            currentProfileData.faculty = editFaculty ? editFaculty.value : '';
            currentProfileData.department = editDepartment ? editDepartment.value : '';
            currentProfileData.taughtCourses = editTaughtCourses ? editTaughtCourses.value : '';
        }
        
        // Save to localStorage for persistence
        localStorage.setItem(`userProfile_${currentUserRole}`, JSON.stringify(currentProfileData));

        updateProfileDisplay(); // Update displayed info
        hideElement(editProfileModal);
        showToastNotification('Profil berhasil diperbarui!', 'success');
    }

    // Render Purchased Packages
    function renderPurchasedPackages() {
        if (!purchasedPackagesContainer || !invoiceContainer) {
            console.warn("Packages or Invoice container not found. Skipping render.");
            return;
        }
        purchasedPackagesContainer.innerHTML = '';
        invoiceContainer.innerHTML = '';

        const purchasedPackages = JSON.parse(localStorage.getItem('purchasedPackages') || '[]');

        if (purchasedPackages.length === 0) {
            purchasedPackagesContainer.innerHTML = '<p class="text-gray-600">Anda belum memiliki paket aktif. <a href="paket.html" class="text-blue-600 hover:underline">Beli Paket Sekarang!</a></p>';
            invoiceContainer.innerHTML = '<p class="text-gray-600">Tidak ada riwayat invoice.</p>';
            return;
        }

        purchasedPackages.forEach((pkg, index) => {
            let statusText = '';
            let statusColor = '';
            const today = new Date();
            const expiryDateObj = pkg.expiryDate === 'Lifetime' ? null : new Date(pkg.expiryDate);

            if (expiryDateObj && today > expiryDateObj) {
                statusText = 'Kadaluarsa';
                statusColor = 'text-red-500';
            } else {
                statusText = 'Aktif';
                statusColor = 'text-green-500';
            }

            const packageCard = document.createElement('div');
            packageCard.className = 'bg-gradient-card p-6 rounded-lg shadow-md card-hover';
            packageCard.innerHTML = `
                <h4 class="text-xl font-bold text-gray-900 mb-2">${pkg.name}</h4>
                <p class="text-gray-700 mb-1">Jenis: ${pkg.accessModel === 'one-time' ? 'Pembelian Satu Kali' : 'Langganan'}</p>
                <p class="text-gray-700 mb-1">Harga: Rp ${pkg.price.toLocaleString('id-ID')}</p>
                <p class="text-gray-700 mb-1">Dibeli Pada: ${pkg.purchaseDate}</p>
                <p class="text-gray-700 mb-3">Akses Hingga: <span class="${statusColor} font-semibold">${pkg.expiryDate}</span> (<span class="${statusColor}">${statusText}</span>)</p>
                <div class="flex flex-col sm:flex-row gap-2 mt-4">
                    <button onclick="accessContent('${pkg.contentAccessPage}')" class="w-full sm:w-auto bg-blue-600 text-white py-2 px-4 rounded-lg font-semibold hover:bg-blue-700 transition-all">
                        <i class="fas fa-play-circle mr-2"></i> Lanjutkan Belajar
                    </button>
                    ${statusText === 'Kadaluarsa' || pkg.accessModel === 'subscription' ? `
                    <a href="perpanjang.html" class="w-full sm:w-auto bg-yellow-400 text-blue-900 py-2 px-4 rounded-lg hover:bg-yellow-300 transition-all text-center">
                        <i class="fas fa-sync-alt mr-2"></i> Perpanjang
                    </a>` : ''}
                </div>
            `;
            purchasedPackagesContainer.appendChild(packageCard);

            // Render invoice entry
            const invoiceCard = document.createElement('div');
            invoiceCard.className = 'bg-gradient-card p-4 rounded-lg shadow-md';
            invoiceCard.innerHTML = `
                <p class="font-semibold text-gray-800">Invoice #${(index + 1).toString().padStart(4, '0')}</p>
                <p class="text-gray-700">Paket: ${pkg.name}</p>
                <p class="text-gray-700">Total: Rp ${pkg.price.toLocaleString('id-ID')}</p>
                <p class="text-gray-700">Metode: Transfer Bank (Simulasi)</p>
                <p class="text-gray-700">Tanggal: ${pkg.purchaseDate}</p>
                <button onclick="downloadDummyPdf('invoice_unnes_study_zone_${pkg.purchaseDate}_${index}.pdf')" class="mt-2 bg-gray-200 text-gray-800 py-1 px-3 rounded-lg text-sm hover:bg-gray-300 transition-colors">
                    <i class="fas fa-file-invoice mr-1"></i> Unduh Resi Dummy
                </button>
            `;
            invoiceContainer.appendChild(invoiceCard);
        });
    }

    // Render Learning Progress (Student View)
    function renderStudentLearningProgress() {
        const lp = currentProfileData.learningProgress;
        if (!lp) { // If no learning progress data, show no content messages
            if (noCoursesInProgress) showElement(noCoursesInProgress);
            if (noCompletedLessons) showElement(noCompletedLessons);
            if (noQuizScores) showElement(noQuizScores);
            if (noBadges) showElement(noBadges);
            if (noCertifications) showElement(noCertifications);
            return;
        }


        // Courses in Progress
        if (coursesInProgressContainer) {
            coursesInProgressContainer.innerHTML = '';
            if (lp.coursesInProgress && lp.coursesInProgress.length > 0) {
                if (noCoursesInProgress) hideElement(noCoursesInProgress);
                lp.coursesInProgress.forEach(course => {
                    const courseDiv = document.createElement('div');
                    courseDiv.className = 'bg-gradient-card p-4 rounded-lg shadow-md flex items-center justify-between';
                    courseDiv.innerHTML = `
                        <div>
                            <p class="font-semibold text-gray-800">${course.name}</p>
                            <p class="text-sm text-gray-600">Progres: ${course.progress}% selesai</p>
                            <p class="text-xs text-gray-500">Terakhir diakses: ${course.lastAccessed}</p>
                        </div>
                        <button onclick="accessContent('${course.link}')" class="bg-blue-500 text-white py-1 px-3 rounded-lg text-sm hover:bg-blue-600">Lanjutkan</button>
                    `;
                    coursesInProgressContainer.appendChild(courseDiv);
                });
            } else {
                if (noCoursesInProgress) showElement(noCoursesInProgress);
            }
        }


        // Completed Lessons
        if (completedLessonsList) {
            completedLessonsList.innerHTML = '';
            if (lp.completedLessons && lp.completedLessons.length > 0) {
                if (noCompletedLessons) hideElement(noCompletedLessons);
                lp.completedLessons.forEach(lesson => {
                    const li = document.createElement('li');
                    li.textContent = lesson;
                    completedLessonsList.appendChild(li);
                });
            } else {
                if (noCompletedLessons) showElement(noCompletedLessons);
            }
        }


        // Quiz Scores
        if (quizScoresContainer) {
            quizScoresContainer.innerHTML = '';
            if (lp.quizScores && lp.quizScores.length > 0) {
                if (noQuizScores) hideElement(noQuizScores);
                lp.quizScores.forEach(quiz => {
                    const quizDiv = document.createElement('div');
                    quizDiv.className = 'bg-gradient-card p-4 rounded-lg shadow-md flex items-center justify-between';
                    quizDiv.innerHTML = `
                        <div>
                            <p class="font-semibold text-gray-800">${quiz.name}</p>
                            <p class="text-sm text-gray-600">Skor: ${quiz.score} (<span class="text-green-600">${quiz.topics}</span>)</p>
                        </div>
                        <button onclick="accessContent('${quiz.link}')" class="bg-blue-500 text-white py-1 px-3 rounded-lg text-sm hover:bg-blue-600">Lihat Hasil</button>
                    `;
                    quizScoresContainer.appendChild(quizDiv);
                });
            } else {
                if (noQuizScores) showElement(noQuizScores);
            }
        }


        // Badges
        if (badgesContainer) {
            badgesContainer.innerHTML = '';
            if (lp.badges && lp.badges.length > 0) {
                if (noBadges) hideElement(noBadges);
                lp.badges.forEach(badge => {
                    const badgeDiv = document.createElement('div');
                    badgeDiv.className = 'badge-item';
                    badgeDiv.innerHTML = `<i class="${badge.icon}"></i><span>${badge.name}</span>`;
                    badgesContainer.appendChild(badgeDiv);
                });
            } else {
                if (noBadges) showElement(noBadges);
            }
        }

        // Certifications
        if (certificationsContainer) {
            certificationsContainer.innerHTML = '';
            if (lp.certifications && lp.certifications.length > 0) {
                if (noCertifications) hideElement(noCertifications);
                lp.certifications.forEach(cert => {
                    const certDiv = document.createElement('div');
                    certDiv.className = 'bg-gradient-card p-4 rounded-lg shadow-md flex items-center justify-between';
                    certDiv.innerHTML = `
                        <div>
                            <p class="font-semibold text-gray-800">${cert.name}</p>
                            <p class="text-sm text-gray-600">Diterbitkan: ${cert.issuedDate}</p>
                        </div>
                        <button onclick="downloadDummyPdf('${cert.filename}')" class="bg-green-500 text-white py-1 px-3 rounded-lg text-sm hover:bg-green-600">
                            <i class="fas fa-download mr-1"></i> Unduh PDF Dummy
                        </button>
                    `;
                    certificationsContainer.appendChild(certDiv);
                });
            } else {
                if (noCertifications) showElement(noCertifications);
            }
        }
    }

    // Render Security & Privacy Settings
    function renderSecurityPrivacySettings() {
        if (!emailNotificationsToggle || !publicProfileVisibilityToggle) {
            console.warn("Email or Public Profile toggle not found. Skipping render.");
            return;
        }

        if (currentProfileData.privacy) {
            emailNotificationsToggle.checked = currentProfileData.privacy.emailNotifications;
            publicProfileVisibilityToggle.checked = currentProfileData.privacy.publicProfile;
        } else {
            // Default if no privacy settings stored
            emailNotificationsToggle.checked = true;
            publicProfileVisibilityToggle.checked = false;
        }

        // Simulate 2FA status
        const is2FAActive = localStorage.getItem('2FA_active') === 'true';
        if (twoFactorAuthToggle) { // Check if element exists
          twoFactorAuthToggle.checked = is2FAActive;
        }
        update2FAStatusDisplay(is2FAActive);
    }

    // Save Security & Privacy Settings (simulated)
    function saveSecurityPrivacySettings() {
        if (!emailNotificationsToggle || !publicProfileVisibilityToggle) {
            showToastNotification('Gagal menyimpan: Toggle notifikasi/privasi tidak ditemukan.', 'error');
            return;
        }
        currentProfileData.privacy = {
            emailNotifications: emailNotificationsToggle.checked,
            publicProfile: publicProfileVisibilityToggle.checked
        };
        localStorage.setItem(`userProfile_${currentUserRole}`, JSON.stringify(currentProfileData));
        showToastNotification('Pengaturan privasi & keamanan berhasil disimpan!', 'success');
    }

    // Update 2FA Status Display
    function update2FAStatusDisplay(isActive) {
        if (!twoFactorAuthStatus || !twoFactorAuthText || !twoFactorAuthIcon) {
            console.error("One or more 2FA elements not found! Cannot update display.");
            return;
        }

        if (isActive) {
            twoFactorAuthText.textContent = 'Aktif';
            twoFactorAuthStatus.classList.remove('text-red-500');
            twoFactorAuthStatus.classList.add('text-green-600');
            twoFactorAuthIcon.classList.remove('fa-times-circle');
            twoFactorAuthIcon.classList.add('fa-check-circle');
        } else {
            twoFactorAuthText.textContent = 'Tidak Aktif';
            twoFactorAuthStatus.classList.remove('text-green-600');
            twoFactorAuthStatus.classList.add('text-red-500');
            twoFactorAuthIcon.classList.remove('fa-check-circle');
            twoFactorAuthIcon.classList.add('fa-times-circle');
        }
    }

    // Render Notification Preferences
    function renderNotificationPreferences() {
        // Ensure all notification toggles exist before accessing
        if (!togglePlatformUpdates || !toggleCourseAnnouncements || !toggleNewMessages || !toggleNewMaterialRecommendations || !toggleDeadlineReminders) {
            console.warn("One or more notification toggles not found. Skipping render.");
            return;
        }

        if (currentProfileData.notifications) {
            togglePlatformUpdates.checked = currentProfileData.notifications.platformUpdates;
            toggleCourseAnnouncements.checked = currentProfileData.notifications.courseAnnouncements;
            toggleNewMessages.checked = currentProfileData.notifications.newMessages;
            toggleNewMaterialRecommendations.checked = currentProfileData.notifications.newMaterialRecommendations;
            toggleDeadlineReminders.checked = currentProfileData.notifications.deadlineReminders;
        } else {
            // Default if no notification settings stored
            togglePlatformUpdates.checked = true;
            toggleCourseAnnouncements.checked = true;
            toggleNewMessages.checked = true;
            toggleNewMaterialRecommendations.checked = true;
            toggleDeadlineReminders.checked = true;
        }
    }

    // Save Notification Preferences (simulated)
    function saveNotificationPreferences() {
        if (!togglePlatformUpdates || !toggleCourseAnnouncements || !toggleNewMessages || !toggleNewMaterialRecommendations || !toggleDeadlineReminders) {
            showToastNotification('Gagal menyimpan: Toggle notifikasi tidak ditemukan.', 'error');
            return;
        }
        currentProfileData.notifications = {
            platformUpdates: togglePlatformUpdates.checked,
            courseAnnouncements: toggleCourseAnnouncements.checked,
            newMessages: toggleNewMessages.checked,
            newMaterialRecommendations: toggleNewMaterialRecommendations.checked,
            deadlineReminders: toggleDeadlineReminders.checked
        };
        localStorage.setItem(`userProfile_${currentUserRole}`, JSON.stringify(currentProfileData));
        showToastNotification('Preferensi notifikasi berhasil disimpan!', 'success');
    }

    // Function to handle content access (e.g., redirect to materi.html or tryout.html)
    function accessContent(pageUrl) {
        if (loadingScreen) {
            showElement(loadingScreen);
        }
        setTimeout(() => {
            window.location.href = pageUrl;
        }, 300); // Simulate a small delay for loading
    }


    // Handle Tab Switching
    function switchTab(tabId) {
        // Deactivate all tabs
        document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
        // Hide all content
        const allTabContents = document.querySelectorAll('.tab-content');
        allTabContents.forEach(content => hideElement(content));

        // Activate selected tab and show content
        if (tabId === 'profile') {
            if (tabProfile) tabProfile.classList.add('active');
            if (contentProfile) showElement(contentProfile);
            updateProfileDisplay();
        } else if (tabId === 'packages') {
            if (tabPackages) tabPackages.classList.add('active');
            if (contentPackages) showElement(contentPackages);
            renderPurchasedPackages();
        } else if (tabId === 'learning-progress') {
            if (tabLearningProgress) tabLearningProgress.classList.add('active');
            if (contentLearningProgress) showElement(contentLearningProgress);
            // Render content based on current role
            if (currentUserRole === 'student') {
                if (studentLearningProgress) showElement(studentLearningProgress);
                if (teacherLearningProgress) hideElement(teacherLearningProgress);
                if (adminLearningProgress) hideElement(adminLearningProgress);
                renderStudentLearningProgress(); // Render student specific content
            } else if (currentUserRole === 'teacher') {
                if (teacherLearningProgress) showElement(teacherLearningProgress);
                if (studentLearningProgress) hideElement(studentLearningProgress);
                if (adminLearningProgress) hideElement(adminLearningProgress);
            } else if (currentUserRole === 'admin') {
                if (adminLearningProgress) showElement(adminLearningProgress);
                if (studentLearningProgress) hideElement(studentLearningProgress);
                if (teacherLearningProgress) hideElement(teacherLearningProgress);
            }
        } else if (tabId === 'security-privacy') {
            if (tabSecurityPrivacy) tabSecurityPrivacy.classList.add('active');
            if (contentSecurityPrivacy) showElement(contentSecurityPrivacy);
            renderSecurityPrivacySettings();
        } else if (tabId === 'notifications') {
            if (tabNotifications) tabNotifications.classList.add('active');
            if (contentNotifications) showElement(contentNotifications);
            renderNotificationPreferences();
        } else if (tabId === 'teacher-admin-features') {
            if (tabTeacherAdminFeatures) tabTeacherAdminFeatures.classList.add('active');
            if (contentTeacherAdminFeatures) showElement(contentTeacherAdminFeatures);
            if (currentUserRole === 'teacher') {
                if (teacherAdminFeatureTitle) teacherAdminFeatureTitle.textContent = 'Fitur Dosen';
                if (teacherFeaturesContent) showElement(teacherFeaturesContent);
                if (adminFeaturesContent) hideElement(adminFeaturesContent);
            } else if (currentUserRole === 'admin') {
                if (teacherAdminFeatureTitle) teacherAdminFeatureTitle.textContent = 'Fitur Administrator';
                if (adminFeaturesContent) showElement(adminFeaturesContent);
                if (teacherFeaturesContent) hideElement(teacherFeaturesContent);
            }
        } else {
            console.warn(`Tab with ID '${tabId}' not found or handled.`);
        }
    }

    // Function to download a dummy PDF (for certificates/invoices)
    function downloadDummyPdf(filename) {
        const dummyContent = "Ini adalah dokumen dummy sertifikat/invoice dari UNNES Study Zone.\n\nSimulasi Unduhan Berhasil!";
        const blob = new Blob([dummyContent], { type: 'application/pdf' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        showToastNotification(`Mengunduh ${filename}...`, 'info');
    }

    // --- Event Listeners ---
    document.addEventListener('DOMContentLoaded', () => {
        // Initial load of user data (default to student)
        loadUserData(currentUserRole);

        // Mobile menu toggle
        if (menuBtn && mobileMenu) {
            menuBtn.addEventListener('click', () => {
                mobileMenu.classList.toggle('hidden');
                menuBtn.querySelector('i').classList.toggle('fa-bars');
                menuBtn.querySelector('i').classList.toggle('fa-times');
            });
        }

        // Scroll progress bar
        window.addEventListener('scroll', () => {
            const scrollTop = window.scrollY;
            const docHeight = document.documentElement.scrollHeight - window.innerHeight;
            const scrollPercent = (docHeight > 0) ? (scrollTop / docHeight) * 100 : 0;
            scrollProgress.style.width = scrollPercent + '%';
        });

        // Back-to-top button
        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) {
                backToTop.classList.remove('hidden');
            } else {
                backToTop.classList.add('hidden');
            }
        });
        if (backToTop) { // Check if element exists before adding listener
          backToTop.addEventListener('click', () => {
              window.scrollTo({ top: 0, behavior: 'smooth' });
          });
        }


        // Role Selector
        if (roleSelector) {
            roleSelector.addEventListener('change', (e) => {
                currentUserRole = e.target.value;
                loadUserData(currentUserRole); // Reload data and update UI based on new role
            });
        }


        // Tab Navigation
        if (tabProfile) tabProfile.addEventListener('click', () => switchTab('profile'));
        if (tabPackages) tabPackages.addEventListener('click', () => switchTab('packages'));
        if (tabLearningProgress) tabLearningProgress.addEventListener('click', () => switchTab('learning-progress'));
        if (tabSecurityPrivacy) tabSecurityPrivacy.addEventListener('click', () => switchTab('security-privacy'));
        if (tabNotifications) tabNotifications.addEventListener('click', () => switchTab('notifications'));
        if (tabTeacherAdminFeatures) tabTeacherAdminFeatures.addEventListener('click', () => switchTab('teacher-admin-features'));

        // Edit Profile Modal functionality
        if (editProfileBtn) {
            editProfileBtn.addEventListener('click', () => {
                populateEditProfileModal();
                showElement(editProfileModal);
            });
        }
        if (cancelEdit) {
            cancelEdit.addEventListener('click', () => {
                hideElement(editProfileModal);
            });
        }
        if (editProfileForm) {
            editProfileForm.addEventListener('submit', saveProfileChanges);
        }

        if (profilePhotoInput) {
            profilePhotoInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        if (profilePhotoPreview) {
                            profilePhotoPreview.src = event.target.result;
                        }
                        currentProfileData.profilePhoto = event.target.result; // Store base64 data for persistence (simulated)
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        // Change Password Modal functionality
        if (changePasswordBtn) {
            changePasswordBtn.addEventListener('click', () => {
                if (oldPassword) oldPassword.value = '';
                if (newPassword) newPassword.value = '';
                if (confirmNewPassword) confirmNewPassword.value = '';
                if (passwordMessage) {
                    passwordMessage.textContent = '';
                    hideElement(passwordMessage);
                }
                showElement(changePasswordModal);
            });
        }
        if (cancelChangePassword) {
            cancelChangePassword.addEventListener('click', () => {
                hideElement(changePasswordModal);
            });
        }
        if (changePasswordForm) {
            changePasswordForm.addEventListener('submit', (e) => {
                e.preventDefault();
                let message = '';
                let type = 'error';

                if (!newPassword || !oldPassword || !confirmNewPassword || !passwordMessage) {
                    message = 'Kesalahan formulir: Beberapa elemen tidak ditemukan.';
                } else if (newPassword.value === oldPassword.value) {
                    message = 'Kata sandi baru tidak boleh sama dengan kata sandi lama.';
                } else if (newPassword.value !== confirmNewPassword.value) {
                    message = 'Konfirmasi kata sandi baru tidak cocok.';
                } else if (newPassword.value.length < 6) { // Simple validation
                    message = 'Kata sandi baru minimal 6 karakter.';
                } else {
                    message = 'Kata sandi berhasil diubah! (Simulasi)';
                    type = 'success';
                }

                passwordMessage.textContent = message;
                passwordMessage.classList.remove('text-red-500', 'text-green-500');
                if (type === 'error') {
                    passwordMessage.classList.add('text-red-500');
                } else {
                    passwordMessage.classList.add('text-green-500');
                }
                showElement(passwordMessage);
                showToastNotification(message, type);

                if (type === 'success') {
                    setTimeout(() => { hideElement(changePasswordModal); }, 1500);
                }
            });
        }

        // 2FA Toggle
        if (twoFactorAuthToggle) {
            twoFactorAuthToggle.addEventListener('change', (e) => {
                const isActive = e.target.checked;
                localStorage.setItem('2FA_active', isActive); // Simulate persistence
                update2FAStatusDisplay(isActive);
                showToastNotification(`2FA ${isActive ? 'diaktifkan' : 'dinonaktifkan'} (Simulasi)!`, 'info');
            });
        }


        // Deactivate Account
        if (deactivateAccountBtn) {
            deactivateAccountBtn.addEventListener('click', () => {
                showElement(deactivateModal);
            });
        }
        if (cancelDeactivate) {
            cancelDeactivate.addEventListener('click', () => {
                hideElement(deactivateModal);
            });
        }
        if (confirmDeactivate) {
            confirmDeactivate.addEventListener('click', () => {
                hideElement(deactivateModal);
                showToastNotification('Akun Anda telah dinonaktifkan (Simulasi).', 'info');
                // In a real app: backend call to deactivate, then redirect to login.
                setTimeout(() => { window.location.href = 'login.html'; }, 1500);
            });
        }

        // Delete Account
        if (deleteAccountBtn) {
            deleteAccountBtn.addEventListener('click', () => {
                showElement(deleteModal);
            });
        }
        if (cancelDelete) {
            cancelDelete.addEventListener('click', () => {
                hideElement(deleteModal);
            });
        }
        if (confirmDelete) {
            confirmDelete.addEventListener('click', () => {
                hideElement(deleteModal);
                showToastNotification('Akun Anda telah dihapus permanen (Simulasi).', 'error');
                localStorage.clear(); // Clear all local storage for this user (simulated)
                // In a real app: backend call to delete, then redirect to login.
                setTimeout(() => { window.location.href = 'login.html'; }, 1500);
            });
        }

        // Export Data
        if (exportDataBtn) {
            exportDataBtn.addEventListener('click', () => {
                const dataToExport = {
                    profile: currentProfileData,
                    purchasedPackages: JSON.parse(localStorage.getItem('purchasedPackages') || '[]'),
                    learningProgress: currentProfileData.learningProgress,
                    settings: {
                        privacy: currentProfileData.privacy,
                        notifications: currentProfileData.notifications,
                        twoFactorAuth: localStorage.getItem('2FA_active') === 'true'
                    }
                };
                const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(dataToExport, null, 2));
                const downloadAnchorNode = document.createElement('a');
                downloadAnchorNode.setAttribute("href", dataStr);
                downloadAnchorNode.setAttribute("download", `unnes_study_zone_data_${currentUserRole}.json`);
                document.body.appendChild(downloadAnchorNode); // Required for Firefox
                downloadAnchorNode.click();
                downloadAnchorNode.remove();
                showToastNotification('Data Anda sedang diunduh!', 'info');
            });
        }

        // Save Notification Preferences
        if (saveNotificationPreferencesBtn) {
            saveNotificationPreferencesBtn.addEventListener('click', saveNotificationPreferences);
        }

        // Logout functionality
        if (logoutBtn) {
            logoutBtn.addEventListener('click', () => {
                showElement(logoutModal);
            });
        }
        if (cancelLogout) {
            cancelLogout.addEventListener('click', () => {
                hideElement(logoutModal);
            });
        }
        if (confirmLogout) {
            confirmLogout.addEventListener('click', (e) => {
                e.preventDefault(); // Prevent default if any
                hideElement(logoutModal);
                showToastNotification('Berhasil logout!', 'success');
                setTimeout(() => {
                    window.location.href = 'login.html'; // Redirect to login page
                }, 1000); // Give time for toast to show
            });
        }

        // Show loading spinner on page transition
        document.querySelectorAll('a[href]').forEach(link => {
            link.addEventListener('click', (e) => {
                const href = link.getAttribute('href');
                if (href && !href.startsWith('#') && !href.includes('whatsapp') && !link.href.includes('instagram') && !link.href.includes('twitter') && !link.href.includes('facebook') && !link.href.includes('youtube') && !href.includes('mailto:')) {
                    if (loadingScreen) {
                        showElement(loadingScreen);
                    }
                }
            });
        });

        // Navbar scroll effect
        window.addEventListener('scroll', () => {
            if (window.scrollY > 100) {
                if (navbar) navbar.classList.add('scrolled', 'shadow-lg');
            } else {
                if (navbar) navbar.classList.remove('scrolled', 'shadow-lg');
            }
        });
    });
  </script>
</body>
</html>
